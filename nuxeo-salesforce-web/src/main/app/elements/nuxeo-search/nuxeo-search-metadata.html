<dom-module id="nuxeo-search-metadata">
  <style>
    .mainToolbar {
      color: inherit;
      background-color: var(--primary-background-color);
    }

    .card {
      margin: 5px;
      width: 100%;
      display: inline-block;
      @apply(--shadow-elevation-3dp);
    }

    .metaData {
      padding: 5px;
    }

    .property {
      margin: 5px;
      font-size: 14px;
      display: block;
    }

    .property .label {
      width: 110px;
      overflow: hidden;
      text-overflow: ellipsis;
      float: left;
      font-weight: bold;
    }

    .property .value {
      margin-left: 0;
      flex: 1;
    }

    @media (max-width: 600px) {
      h1.paper-font-display1 {
        font-size: 24px;
      }
    }

    .documentIcon {
      padding-right: 5px;
      vertical-align: text-top;
    }

    .iconSize {
      max-width: 24px;
      max-height: 24px;
    }

    #spacer {
      display: table;
      margin: 0 auto;
    }

    .docContainer {
      display: table;
    }

    .docTitleContainer {
      display: table-cell;
      vertical-align: middle;
    }

    .docTitle {
      overflow: hidden;
      text-overflow: ellipsis;
      width: 210px;
      white-space: nowrap;
    }

  </style>

  <template>

    <nuxeo-connection id="nx"></nuxeo-connection>
    <nuxeo-resource auto path="/id/[[docId]]" response="{{doc}}" enrichers="preview, documentURL, driveEditURL"></nuxeo-resource>

    <paper-header-panel mode="waterfall">

      <paper-toolbar class="mainToolbar">
        <div class="docContainer">
          <iron-icon src="[[icon]]" class="documentIcon iconSize"></iron-icon>
          <div class="docTitleContainer">
            <div class="docTitle">{{doc.title}}</div>
          </div>
        </div>
        <div id="spacer">
          <!--This div pushes the action buttons to the right edge. -->
        </div>
        <div id="folderOpenExternal">
          <a href="[[_docURL(doc)]]" target="_blank">
            <paper-icon-button icon="icons:open-in-new" title="Access"></paper-icon-button>
          </a>
        </div>
      </paper-toolbar>

      <div>
        <template is="dom-if" if="[[thumbnail]]">
          <div class="card">
            <img src$="[[thumbnail]]" style="width:100%"></img>
          </div>
        </template>

        <section id="common" class="card metaData">
          <div class="property">
            <span class="label">Created at</span>
            <span class="value">[[_date(doc, 'dc:created')]]</span>
          </div>

          <div class="property">
            <span class="label">Last modified</span>
            <span class="value">[[_date(doc, 'dc:modified')]]</span>
          </div>

          <div class="property">
            <span class="label">Author</span>
            <span class="value">[[_prop(doc, 'dc:creator')]]</span>
          </div>

          <div class="property">
            <span class="label">Contributors</span>
            <span class="value">[[_prop(doc, 'dc:creator')]]</span>
          </div>

          <div class="property">
            <span class="label">Last contributor</span>
            <span class="value">[[_prop(doc, 'dc:creator')]]</span>
          </div>

        </section>
      </div>
    </paper-header-panel>

  </template>

  <script>
    (function() {
      Polymer({
        is: 'nuxeo-search-metadata',

        properties: {
          docId: {
            type: Object,
            notify: true
          },
          doc: {
            type: Object,
            notify: true
          },
          icon: {
            computed: '_icon(doc)'
          },
          thumbnail: {
            computed: '_thumbnail(doc)'
          }
        },

        _icon: function(doc) {
          if (doc && doc.properties['common:icon']) {
            return this.$.nx.client._baseURL + doc.properties['common:icon'];
          }
        },

        _docURL: function(doc) {
          if (doc && doc.contextParameters !== undefined) {
            return doc.contextParameters.documentURL;
          }
        },

        _thumbnail: function(doc) {
          if (doc && doc.properties['thumb:thumbnail']) {
            return doc.properties['thumb:thumbnail'].data;
          }

          if (doc && doc.properties['picture:views']) {
            return doc.properties['picture:views'].find(function(view) {
              return view.title === "Small";
            }).content.data;
          }
        },

        _prop: function(doc, path) {
          if (!doc || !doc.properties) {
            return;
          }
          return doc.properties[path];
        },

        _date: function(doc, path) {
          if (!doc || !doc.properties) {
            return;
          }
          return new Date(doc.properties[path]).toLocaleString();
        }

      });
    })();
  </script>

</dom-module>
